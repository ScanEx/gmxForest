var gmxForest=function(t){"use strict";function e(){}function a(t,e){for(var a in e)t[a]=e[a];return t}function n(t,e){for(var a in e)t[a]=1;return t}function s(t,e){return 0===e&&t(),function(){--e||t()}}function r(t){t()}function o(t,e){t.appendChild(e)}function l(t,e,a){t.insertBefore(e,a)}function i(t){t.parentNode.removeChild(t)}function c(t,e){for(var a=0;a<t.length;a+=1)t[a]&&t[a].d(e)}function u(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function h(){return document.createComment("")}function m(t,e,a,n){t.addEventListener(e,a,n)}function v(t,e,a,n){t.removeEventListener(e,a,n)}function g(t,e,a){null==a?t.removeAttribute(e):t.setAttribute(e,a)}function f(t,e){t.data=""+e}function p(){return Object.create(null)}function _(t){t._lock=!0,x(t._beforecreate),x(t._oncreate),x(t._aftercreate),t._lock=!1}function y(t,e){t._handlers=p(),t._slots=p(),t._bind=e._bind,t._staged={},t.options=e,t.root=e.root||t,t.store=e.store||t.root.store,e.root||(t._beforecreate=[],t._oncreate=[],t._aftercreate=[])}function x(t){for(;t&&t.length;)t.shift()()}var k={destroy:function(t){this.destroy=e,this.fire("destroy"),this.set=e,this._fragment.d(!1!==t),this._fragment=null,this._state={}},get:function(){return this._state},fire:function(t,e){var a=t in this._handlers&&this._handlers[t].slice();if(a)for(var n=0;n<a.length;n+=1){var s=a[n];if(!s.__calling)try{s.__calling=!0,s.call(this,e)}finally{s.__calling=!1}}},on:function(t,e){var a=this._handlers[t]||(this._handlers[t]=[]);return a.push(e),{cancel:function(){var t=a.indexOf(e);~t&&a.splice(t,1)}}},set:function(t){this._set(a({},t)),this.root._lock||_(this.root)},_recompute:e,_set:function(t){var e=this._state,n={},s=!1;for(var r in t=a(this._staged,t),this._staged={},t)this._differs(t[r],e[r])&&(n[r]=s=!0);s&&(this._state=a(a({},e),t),this._recompute(n,this._state),this._bind&&this._bind(n,this._state),this._fragment&&(this.fire("state",{changed:n,current:this._state,previous:e}),this._fragment.p(n,this._state),this.fire("update",{changed:n,current:this._state,previous:e})))},_stage:function(t){a(this._staged,t)},_mount:function(t,e){this._fragment[this._fragment.i?"i":"m"](t,e||null)},_differs:function(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}};var b={sort:function(t){var e=this.get().sortType;this.set({sortType:"desc"===e?"asc":"desc",sortKey:t}),this.setCurrPage(1)},checkReverse:function(t){var e={},a=t.ctrlKey,n=t.target.checked;if(a||n){var s=this.get(),r=s.items,o=s.hashCols,l=s.checked,i=o.gmx_id;r.forEach(function(t){var n=t[i];a&&l[n]||(e[n]=!0)})}this.set({checked:e})},checkMe:function(t){var e=this.get().checked;e[t]?delete e[t]:e[t]=!0,this.set({checked:e})},sortMe:function(t,e,a,n){var s=a[e];return t.sort(function(t,e){var a=e[s],r=t[s];return(a<r?-1:a>r?1:0)*("desc"===n?-1:1)})},pageTo:function(t){var e=this.get().pageFrom;return this.set({pageCurr:t}),t=t<1?1:t>e?e:t,this.setCurrPage(t),t},viewItem:function(t){this.root.viewItem(t)},setCurrPage:function(t){var e=this.get(),a=e.items,n=e.hashCols,s=e.pageCurr,r=e.pagesize,o=e.sortKey,l=e.sortType,i=r*((t=t||s)-1),c=(o?this.sortMe(a,o,n,l):a).slice(i,i+r),u=a.length/r,d=Math.floor(u);this.set({tableItems:c,pageCurr:t,pageFrom:d+(u>d?1:0)})}};function N(t){var e=t.changed,a=t.current;t.previous;e.items&&a.items.length&&this.setCurrPage()}function I(t){var e=this._svelte,a=e.component,n=e.ctx;a.viewItem(n.it[n.hashCols.gmx_id])}function j(t){var e=this._svelte,a=e.component,n=e.ctx;a.checkMe(n.it[n.hashCols.gmx_id])}function C(t,e,a){var n=Object.create(t);return n.it=e[a],n}function T(t,e){var a,n,s,r,c,h,p,_,y,x,k,b,N,C=e.it[e.hashCols.gmx_id];return{c:function(){a=u("tr"),n=u("td"),s=u("input"),c=d("\r\n\t\t\t"),h=u("td"),p=u("span"),_=d(C),y=d("\r\n\t\t\t"),x=u("td"),k=u("span"),(N=u("span")).innerHTML='<svg class="svgIcon svelte-1jj6zh"><use xlink:href="#zoom-to-feature"></use></svg>',s._svelte={component:t,ctx:e},m(s,"change",j),s.checked=r=e.checked[e.it[e.hashCols.gmx_id]],g(s,"type","checkbox"),s.className="svelte-1jj6zh",n.className="c1 svelte-1jj6zh",h.className="c2 svelte-1jj6zh",k.className=b="status "+(e.it[e.hashCols.FRSTAT]>0?"checked":"")+" svelte-1jj6zh",N._svelte={component:t,ctx:e},m(N,"click",I),N.className="leaflet-gmx-iconSvg svgIcon svelte-1jj6zh",x.className="c3",a.className="item svelte-1jj6zh"},m:function(t,e){l(t,a,e),o(a,n),o(n,s),o(a,c),o(a,h),o(h,p),o(p,_),o(a,y),o(a,x),o(x,k),o(x,N)},p:function(t,a){e=a,s._svelte.ctx=e,(t.checked||t.tableItems||t.hashCols)&&r!==(r=e.checked[e.it[e.hashCols.gmx_id]])&&(s.checked=r),(t.tableItems||t.hashCols)&&C!==(C=e.it[e.hashCols.gmx_id])&&f(_,C),(t.tableItems||t.hashCols)&&b!==(b="status "+(e.it[e.hashCols.FRSTAT]>0?"checked":"")+" svelte-1jj6zh")&&(k.className=b),N._svelte.ctx=e},d:function(t){t&&i(a),v(s,"change",j),v(N,"click",I)}}}function w(t){var e=this;y(this,t),this._state=a({sortType:"desc",sortKey:"gmx_id",reverse:!1,pageCurr:1,pagesize:15,pageFrom:0,tableItems:[],items:[],hashCols:[]},t.data),this._intro=!!t.intro,this._handlers.state=[N],N.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,h,p,_,y,x,k,b,N,I,j,w,F,D,L,z,S,q,R,O,P,M,V,A,E,G,K,H,W,B,U;function J(e){t.checkReverse(e)}function Q(e){t.sort("gmx_id")}function X(e){t.sort("FRSTAT")}for(var Y=e.tableItems,Z=[],$=0;$<Y.length;$+=1)Z[$]=T(t,C(e,Y,$));function tt(a){t.pageTo(e.pageCurr-1)}function et(e){t.pageTo(this.value)}function at(a){t.pageTo(e.pageCurr+1)}return{c:function(){a=u("div"),n=u("table"),s=u("tr"),h=u("th"),p=u("input"),_=d("\r\n\t\t\t"),y=u("th"),(x=u("span")).textContent="Id",b=d("\r\n\t\t\t"),N=u("th"),(I=u("span")).textContent="Статус",w=d("\r\n");for(var t=0;t<Z.length;t+=1)Z[t].c();F=d("\r\n\t\t"),D=u("tr"),L=u("td"),z=u("button"),S=d("назад"),R=d("\r\n\t\t\t\t"),O=u("span"),P=d("Стр. "),M=u("input"),V=d(" из "),A=d(e.pageFrom),E=d("\r\n\t\t\t\t"),G=u("button"),K=d("вперед"),W=d("\r\n\t\t\t\t"),(B=u("div")).innerHTML='<div class="-loading-inner"></div>',m(p,"click",J),p.checked=e.reverse,g(p,"type","checkbox"),p.value="on",p.className="svelte-1jj6zh",h.className="c1 svelte-1jj6zh",m(y,"click",Q),y.className=k="c2 sorting \r\n\t\t\t\t\t"+("gmx_id"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh",m(N,"click",X),N.className=j="c3 sorting \r\n\t\t\t\t\t"+("FRSTAT"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh",s.className="head svelte-1jj6zh",m(z,"click",tt),z.disabled=q=1===e.pageCurr,m(M,"change",et),g(M,"type","number"),M.value=e.pageCurr,M.className="svelte-1jj6zh",O.className="pageInfo svelte-1jj6zh",m(G,"click",at),G.disabled=H=e.pageFrom===e.pageCurr,B.className="-loading",L.colSpan="3",L.className="svelte-1jj6zh",D.className="pagination svelte-1jj6zh",n.className="table svelte-1jj6zh",a.className="tableContect svelte-1jj6zh"},m:function(t,e){l(t,a,e),o(a,n),o(n,s),o(s,h),o(h,p),o(s,_),o(s,y),o(y,x),o(s,b),o(s,N),o(N,I),o(n,w);for(var r=0;r<Z.length;r+=1)Z[r].m(n,null);o(n,F),o(n,D),o(D,L),o(L,z),o(z,S),o(L,R),o(L,O),o(O,P),o(O,M),o(O,V),o(O,A),o(L,E),o(L,G),o(G,K),o(L,W),o(L,B),U=!0},p:function(a,s){if(e=s,a.reverse&&(p.checked=e.reverse),(a.sortKey||a.sortType)&&k!==(k="c2 sorting \r\n\t\t\t\t\t"+("gmx_id"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh")&&(y.className=k),(a.sortKey||a.sortType)&&j!==(j="c3 sorting \r\n\t\t\t\t\t"+("FRSTAT"===e.sortKey?"desc"===e.sortType?"sorting-desc":"sorting-asc":"")+"\r\n\t\t\t\t\t svelte-1jj6zh")&&(N.className=j),a.tableItems||a.hashCols||a.checked){Y=e.tableItems;for(var r=0;r<Y.length;r+=1){var o=C(e,Y,r);Z[r]?Z[r].p(a,o):(Z[r]=T(t,o),Z[r].c(),Z[r].m(n,F))}for(;r<Z.length;r+=1)Z[r].d(1);Z.length=Y.length}a.pageCurr&&q!==(q=1===e.pageCurr)&&(z.disabled=q),a.pageCurr&&(M.value=e.pageCurr),a.pageFrom&&f(A,e.pageFrom),(a.pageFrom||a.pageCurr)&&H!==(H=e.pageFrom===e.pageCurr)&&(G.disabled=H)},i:function(t,e){U||this.m(t,e)},o:r,d:function(t){t&&i(a),v(p,"click",J),v(y,"click",Q),v(N,"click",X),c(Z,t),v(z,"click",tt),v(M,"change",et),v(G,"click",at)}}}(this,this._state),this.root._oncreate.push(function(){e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this)),this._intro=!0}a(w.prototype,k),a(w.prototype,b);function F(t){var e=t.changed,a=t.current;t.previous;if(e.clicked)if(a.clicked){var n=this.get().cols;this.setSelection(n[0])}else{var s=this.get().value;this.setValue(s)}}function D(t,e,a){var n=Object.create(t);return n.it=e[a],n}function z(t,e){var a;function n(e){t.setValue(e.target.value)}return{c:function(){m(a=u("input"),"change",n),g(a,"type","text"),a.className="gmx-sidebar-input-with-addon svelte-1amu9hw",a.name=e.key,a.value=e.value},m:function(t,e){l(t,a,e)},p:function(t,e){t.key&&(a.name=e.key),t.value&&(a.value=e.value)},d:function(t){t&&i(a),v(a,"change",n)}}}function S(t,e){for(var a,n=e.cols,s=[],r=0;r<n.length;r+=1)s[r]=q(t,D(e,n,r));function o(e){t.setSelection(this.options[this.selectedIndex].value)}return{c:function(){a=u("select");for(var t=0;t<s.length;t+=1)s[t].c();m(a,"change",o),a.name=e.key,a.className="gmx-sidebar-select-with-addon svelte-1amu9hw"},m:function(t,e){l(t,a,e);for(var n=0;n<s.length;n+=1)s[n].m(a,null)},p:function(e,r){if(e.cols||e.colName){n=r.cols;for(var o=0;o<n.length;o+=1){var l=D(r,n,o);s[o]?s[o].p(e,l):(s[o]=q(t,l),s[o].c(),s[o].m(a,null))}for(;o<s.length;o+=1)s[o].d(1);s.length=n.length}e.key&&(a.name=r.key)},d:function(t){t&&i(a),c(s,t),v(a,"change",o)}}}function q(t,e){var a,n,s,r,c=e.it;return{c:function(){a=u("option"),n=d(c),a.__value=s=e.it,a.value=a.__value,a.selected=r=e.colName===e.it},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.cols&&c!==(c=e.it)&&f(n,c),t.cols&&s!==(s=e.it)&&(a.__value=s),a.value=a.__value,(t.colName||t.cols)&&r!==(r=e.colName===e.it)&&(a.selected=r)},d:function(t){t&&i(a)}}}function R(t){var e=this;y(this,t),this._state=a({title:"",value:"",colName:"",clicked:!1,cols:[]},t.data),this._intro=!!t.intro,this._handlers.state=[F],F.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,c,h,g,p,_,y;function x(t){return t.clicked?S:z}var k=x(e),b=k(t,e);function N(a){t.set({clicked:!e.clicked})}return{c:function(){a=u("div"),n=u("div"),s=d(e.title),c=d("\r\n\t"),h=u("div"),g=u("div"),b.c(),p=d("\r\n\t\t\t"),_=u("button"),n.className="gmx-sidebar-label svelte-1amu9hw",m(_,"click",N),_.className="gmx-addon-button svelte-1amu9hw",_.title="выбрать из таблицы атрибутов",a.className="gmx-sidebar-labeled-block svelte-1amu9hw"},m:function(t,e){l(t,a,e),o(a,n),o(n,s),o(a,c),o(a,h),o(h,g),b.m(g,null),o(g,p),o(g,_),y=!0},p:function(a,n){e=n,a.title&&f(s,e.title),k===(k=x(e))&&b?b.p(a,e):(b.d(1),(b=k(t,e)).c(),b.m(g,p))},i:function(t,e){y||this.m(t,e)},o:r,d:function(t){t&&i(a),b.d(),v(_,"click",N)}}}(this,this._state),this.root._oncreate.push(function(){(function(){var t=this.get().key,e=this.root.get().params[t];void 0===e.title&&(e.title=e.value),this.set(e)}).call(e),e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this)),this._intro=!0}a(R.prototype,k),a(R.prototype,{setSelection:function(t){var e=this.get().key;this.root.setField(e,{value:"",field:t})},setValue:function(t){var e=this.get().key;this.root.setField(e,{value:t,field:""})}});var O=window.serverBase||"//maps.kosmosnimki.ru/";var P={viewItem:function(t){for(var e=this.get(),a=e.map,n=e.layerItems,s=e.hashCols,r=0,o=n.length;r<o;r++){var l=n[r];if(t===l[s.gmx_id]){var i=l[s.geomixergeojson],c=L.gmxUtil.getGeometryBounds(i),u=L.latLngBounds([[c.min.y,c.min.x],[c.max.y,c.max.x]]);a.fitBounds(u);break}}},sendReport:function(){var t=this,e=this.get(),a=e.checked,n=e.layerItems,s=e.hashCols,r=e.params,o=e.format,l=e.layerID,i=[],c=[],u=[];return e.gmxMap.layers.forEach(function(t){if(t.getGmxProperties&&t._map){var e=t.getGmxProperties(),a=e.MetaProperties||{},n={layerId:e.name,type:"оптическая"};if(e.Temporal){var s=t.getDateInterval();s.beginDate&&(n.beginDate=s.beginDate.getTime()/1e3),s.endDate&&(n.endDate=s.endDate.getTime()/1e3)}a.type&&(n.type=a.type.Value),a.system&&(n.system=a.system.Value),a.resolution&&(n.resolution=a.resolution.Value),u.push(n)}}),n.forEach(function(e){var n=e[s.gmx_id];if(a[n]){var l={featureID:n,format:o};for(var d in r){var h=r[d],m=t.changedParams[d]||{};l[d]="string"==typeof m?m:m.field?e[s[m.field]]:m.value||h.value}l.satLayers=u,i.push(l),c.push({action:"update",id:n,properties:{FRSTAT:2}})}}),this.set({report:!0}),fetch(O+"Plugins/ForestReport/ForestReportImage",{method:"post",headers:{"Content-type":"application/x-www-form-urlencoded"},body:L.gmxUtil.getFormData({WrapStyle:"None",groupRequest:i}),mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(e){"ok"===e.Status&&t.chkTask(e.Result.TaskID).then(function(e){if("ok"===e.Status){var a=e.Result.Result.downloadFile;a.split("name=")[1];window.open(O+a,"_self"),t.modifyVectorObjects(l,c),t.set({report:!1})}}).catch(function(t){return console.log(t)})}).catch(function(t){return console.log(t)})},chkTask:function(t){return new Promise(function(e,a){var n=setInterval(function(){fetch(O+"AsyncTask.ashx?WrapStyle=None&TaskID="+t,{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(t){var s=t.Result,r=s.Completed;s.ErrorInfo?(clearInterval(n),a(t)):r&&(clearInterval(n),e(t))})},2e3)})},modifyVectorObjects:function(t,e){var a={WrapStyle:"None",LayerName:t,Objects:JSON.stringify(e)};return fetch(O+"VectorLayer/ModifyVectorObjects.ashx?"+L.gmxUtil.getFormData(a),{mode:"cors",credentials:"include",headers:{Accept:"application/json"}}).then(function(t){return t.json()}).catch(function(t){return console.log(t)})},selectFeaturesWithDrawing:function(t,e){var a={WrapStyle:"None",layer:t,columns:'[{"Value":"[gmx_id]"}]',page:0,query:"STIntersects([gmx_geometry], GeometryFromGeoJson('"+JSON.stringify(e)+"', 4326))"};return fetch(O+"VectorLayer/Search.ashx?"+L.gmxUtil.getFormData(a),{mode:"cors",credentials:"include",headers:{Accept:"application/json"}}).then(function(t){return t.json()}).catch(function(t){return console.log(t)})},startDrawing:function(t){var e=this,a=this.get(),n=a.map,s=a.drawstart,r=a.layerID,o=a.checked;this.set({drawstart:!s}),s||(n.gmxDrawing.clear(),n.gmxDrawing.create("Polygon"),n.gmxDrawing.on("drawstop",function(t){e.set({drawstart:!1}),e.selectFeaturesWithDrawing(r,t.object.toGeoJSON().geometry).then(function(t){if("ok"===t.Status&&t.Result){var a=t.Result.values.reduce(function(t,e){return t[e]=!0,t},{});e.root.set({checked:L.extend(a,o)})}})},this),n._gmxEventsManager._drawstart=!0)},setField:function(t,e){this.changedParams[t]=e},setNodeField:function(t,e){var a,n=t.options?t.options[t.selectedIndex].value:t.value;this.setField(t.name,n),e&&this.set(((a={})[t.name]=n,a))},colsToHash:function(t){return t.reduce(function(t,e,a){return t[e]=a,t},{})},loadFeatures:function(t){var e=this;return fetch(O+"VectorLayer/Search.ashx?layer="+t+"&geometry=true&out_cs=EPSG:4326&WrapStyle=None",{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(t){if("ok"===t.Status){var a=t.Result.fields;e.set({cols:a,hashCols:e.colsToHash(a),layerItems:t.Result.values})}}).catch(function(t){return console.log(t)})},getReportsCount:function(){var t=this;return fetch(O+"plugins/forestreport/rest/GetCurrentUserInfo?WrapStyle=None",{mode:"cors",credentials:"include"}).then(function(t){return t.json()}).then(function(e){if("ok"===e.Status){var a=e.Result.limit-e.Result.used;t.set({limit:a>0?a:0})}}).catch(function(t){return console.log(t)})},styleHook:function(t){return this.get().checked[t.id]?{strokeStyle:"#00ffff"}:{}}};function M(t){var e=t.changed,a=t.current;t.previous;if(e.layerID&&a.layerID){var n=this.get(),s=n.gmxMap;n.checked;this.currentLayer=s.layersByID[a.layerID],this.currentLayer&&this.currentLayer.setStyleHook(this.styleHook.bind(this)),this.loadFeatures(a.layerID)}e.checked&&this.currentLayer&&this.currentLayer.repaint()}function V(t,e,a){var n=Object.create(t);return n.it=e[a],n}function A(t,e,a){var n=Object.create(t);return n.it=e[a],n}function E(t,e,a){var n=Object.create(t);return n.it=e[a],n}function G(t,e){for(var a,n=e.layerIds,s=[],r=0;r<n.length;r+=1)s[r]=K(t,E(e,n,r));return{c:function(){for(var t=0;t<s.length;t+=1)s[t].c();a=h()},m:function(t,e){for(var n=0;n<s.length;n+=1)s[n].m(t,e);l(t,a,e)},p:function(e,r){if(e.layerIds||e.layerID){n=r.layerIds;for(var o=0;o<n.length;o+=1){var l=E(r,n,o);s[o]?s[o].p(e,l):(s[o]=K(t,l),s[o].c(),s[o].m(a.parentNode,a))}for(;o<s.length;o+=1)s[o].d(1);s.length=n.length}},d:function(t){c(s,t),t&&i(a)}}}function K(t,e){var a,n,s,r,c=e.it.title;return{c:function(){a=u("option"),n=d(c),a.__value=s=e.it.id,a.value=a.__value,a.selected=r=e.layerID===e.it.id,a.className="svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.layerIds&&c!==(c=e.it.title)&&f(n,c),t.layerIds&&s!==(s=e.it.id)&&(a.__value=s),a.value=a.__value,(t.layerID||t.layerIds)&&r!==(r=e.layerID===e.it.id)&&(a.selected=r)},d:function(t){t&&i(a)}}}function H(t,e){for(var a,n,r,h,p,_,y,x,k,b,N,I,j,C,T,F,D,L,z,S,q,O,P,M,V,E,G,K,H,J,Y,Z,$,tt,et,at,nt,st,rt,ot,lt,it,ct,ut,dt,ht,mt,vt,gt,ft,pt,_t,yt,xt,kt,bt,Nt,It,jt,Ct,Tt,wt,Ft,Dt,Lt,zt,St,qt,Rt,Ot,Pt,Mt,Vt,At,Et=e.params.reportType.title,Gt=e.params.organizationName.title||e.params.organizationName.value,Kt=e.params.inn.title||e.params.inn.value,Ht=e.params.reportType.title,Wt=e.params.quadrantLayerId.title||e.params.quadrantLayerId.value,Bt=e.drawstart?"Полигон рисуется":"Выделите участки полигоном",Ut=e.Object.keys(e.checked).length,Jt=e.layerItems.length,Qt={},Xt=e.params.reportType.options,Yt=[],Zt=0;Zt<Xt.length;Zt+=1)Yt[Zt]=W(t,A(e,Xt,Zt));function $t(e){t.setNodeField(this,!0)}var te="о восстановлении лесов"!==e.reportType&&B(t,e);function ee(e){t.setNodeField(this)}function ae(e){t.setNodeField(this)}var ne={key:"region",cols:e.cols},se=new R({root:t.root,store:t.store,data:ne}),re={key:"forestry",cols:e.cols},oe=new R({root:t.root,store:t.store,data:re}),le={key:"sectionForestry",cols:e.cols},ie=new R({root:t.root,store:t.store,data:le}),ce={key:"quadrant",cols:e.cols},ue=new R({root:t.root,store:t.store,data:ce}),de={key:"stratum",cols:e.cols},he=new R({root:t.root,store:t.store,data:de}),me={key:"site",cols:e.cols},ve=new R({root:t.root,store:t.store,data:me}),ge={key:"recoveryEventType",cols:e.cols},fe=new R({root:t.root,store:t.store,data:ge}),pe={key:"siteArea",cols:e.cols},_e=new R({root:t.root,store:t.store,data:pe});function ye(e){t.setNodeField(this,!0)}var xe=e.quadrantIds&&U(t,e);function ke(e){t.setNodeField(this,!0)}function be(e){t.startDrawing(e)}var Ne={items:e.layerItems,hashCols:e.hashCols};void 0!==e.checked&&(Ne.checked=e.checked,Qt.checked=!0);var Ie=new w({root:t.root,store:t.store,data:Ne,_bind:function(e,a){var n={};!Qt.checked&&e.checked&&(n.checked=a.checked),t._set(n),Qt={}}});function je(t){return t.report?X:Q}t.root._beforecreate.push(function(){Ie._bind({checked:1},Ie.get())});var Ce=je(e),Te=Ce(t,e);return{c:function(){a=u("div"),(n=u("div")).textContent="Ввод информации",r=d("\r\n\t\t\t"),h=u("div"),p=u("div"),_=u("div"),y=u("div"),x=d(Et),k=d("\r\n\t\t\t\t\t\t"),b=u("select");for(var t=0;t<Yt.length;t+=1)Yt[t].c();N=d("\r\n"),te&&te.c(),I=d("\r\n\t\t\t\t\t"),j=u("div"),C=u("div"),T=d(Gt),F=d("\r\n\t\t\t\t\t\t"),D=u("input"),z=d("\r\n\t\t\t\t\t"),S=u("div"),q=u("div"),O=d(Kt),P=d("\r\n\t\t\t\t\t\t"),M=u("input"),E=d("\r\n\r\n\t\t\t\t\t"),se._fragment.c(),G=d("\r\n\t\t\t\t\t"),oe._fragment.c(),K=d("\r\n\t\t\t\t\t"),ie._fragment.c(),H=d("\r\n\t\t\t\t\t"),ue._fragment.c(),J=d("\r\n\t\t\t\t\t"),he._fragment.c(),Y=d("\r\n\t\t\t\t\t"),ve._fragment.c(),Z=d("\r\n\t\t\t\t\t"),fe._fragment.c(),$=d("\r\n\t\t\t\t\t"),_e._fragment.c(),tt=d("\r\n\r\n\t\t\t\t\t\r\n\t\t\t\t\t"),et=u("div"),at=u("div"),nt=d(Ht),st=d("\r\n\t\t\t\t\t\t"),rt=u("select"),(ot=u("option")).textContent="1:5000",(lt=u("option")).textContent="1:10000",(it=u("option")).textContent="1:15000",(ct=u("option")).textContent="1:20000",(ut=u("option")).textContent="1:25000",(dt=u("option")).textContent="1:30000",(ht=u("option")).textContent="1:35000",(mt=u("option")).textContent="1:40000",(vt=u("option")).textContent="1:45000",(gt=u("option")).textContent="1:50000",ft=d("\r\n\t\t\t\t\t"),pt=u("div"),_t=u("div"),yt=d(Wt),xt=d("\r\n\t\t\t\t\t\t"),kt=u("select"),bt=u("option"),xe&&xe.c(),Nt=d("\r\n\t\t\t"),(It=u("div")).textContent="Список объектов",jt=d("\r\n\t\t\t"),Ct=u("div"),Tt=u("div"),wt=u("div"),Ft=u("button"),Dt=d(Bt),Lt=d("\r\n\t\t\t\t\t"),zt=u("div"),St=d("Выделено: "),qt=d(Ut),Rt=d(" / "),Ot=d(Jt),Pt=d("\r\n\t\t\t\t\t"),Ie._fragment.c(),Mt=d("\r\n\t\t\t"),Vt=u("div"),Te.c(),n.className="gmx-sidebar-label-medium svelte-gt11xl",y.className="gmx-sidebar-label svelte-gt11xl",m(b,"change",$t),b.name="reportType",b.className="gmx-sidebar-select-large svelte-gt11xl",_.className="gmx-sidebar-labeled-block svelte-gt11xl",C.className="gmx-sidebar-label-small svelte-gt11xl",m(D,"change",ee),D.name="organizationName",D.value=L=e.params.organizationName.value,g(D,"type","text"),D.className="gmx-sidebar-input-large svelte-gt11xl",j.className="gmx-sidebar-labeled-block svelte-gt11xl",q.className="gmx-sidebar-label-small svelte-gt11xl",m(M,"change",ae),M.name="inn",M.value=V=e.params.inn.value,g(M,"type","text"),M.className="gmx-sidebar-input-large svelte-gt11xl",S.className="gmx-sidebar-labeled-block svelte-gt11xl",at.className="gmx-sidebar-label svelte-gt11xl",ot.__value="5000",ot.value=ot.__value,ot.className="svelte-gt11xl",lt.__value="10000",lt.value=lt.__value,lt.className="svelte-gt11xl",it.__value="15000",it.value=it.__value,it.className="svelte-gt11xl",ct.__value="20000",ct.value=ct.__value,ct.className="svelte-gt11xl",ut.__value="25000",ut.value=ut.__value,ut.className="svelte-gt11xl",dt.__value="30000",dt.value=dt.__value,dt.className="svelte-gt11xl",ht.__value="35000",ht.value=ht.__value,ht.className="svelte-gt11xl",mt.__value="40000",mt.value=mt.__value,mt.className="svelte-gt11xl",vt.__value="45000",vt.value=vt.__value,vt.className="svelte-gt11xl",gt.__value="50000",gt.value=gt.__value,gt.className="svelte-gt11xl",m(rt,"change",ye),rt.name="scale",rt.className="gmx-sidebar-select-large svelte-gt11xl",et.className="gmx-sidebar-labeled-block svelte-gt11xl",_t.className="gmx-sidebar-label svelte-gt11xl",bt.__value="",bt.value=bt.__value,bt.className="svelte-gt11xl",m(kt,"change",ke),kt.name="quadrantLayerId",kt.className="gmx-sidebar-select-large svelte-gt11xl",pt.className="gmx-sidebar-labeled-block svelte-gt11xl",It.className="gmx-sidebar-label-medium svelte-gt11xl",m(Ft,"click",be),Ft.className="gmx-sidebar-button svelte-gt11xl",wt.className="gmx-geometry-select-container svelte-gt11xl",zt.className="gmx-sidebar-label-medium svelte-gt11xl",Ct.className="forest-features-block svelte-gt11xl",Vt.className="gmx-button-container svelte-gt11xl",a.className="leftContent forest-plugin-content svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n),o(a,r),o(a,h),o(h,p),o(p,_),o(_,y),o(y,x),o(_,k),o(_,b);for(var s=0;s<Yt.length;s+=1)Yt[s].m(b,null);o(p,N),te&&te.m(p,null),o(p,I),o(p,j),o(j,C),o(C,T),o(j,F),o(j,D),o(p,z),o(p,S),o(S,q),o(q,O),o(S,P),o(S,M),o(p,E),se._mount(p,null),o(p,G),oe._mount(p,null),o(p,K),ie._mount(p,null),o(p,H),ue._mount(p,null),o(p,J),he._mount(p,null),o(p,Y),ve._mount(p,null),o(p,Z),fe._mount(p,null),o(p,$),_e._mount(p,null),o(p,tt),o(p,et),o(et,at),o(at,nt),o(et,st),o(et,rt),o(rt,ot),o(rt,lt),o(rt,it),o(rt,ct),o(rt,ut),o(rt,dt),o(rt,ht),o(rt,mt),o(rt,vt),o(rt,gt),o(p,ft),o(p,pt),o(pt,_t),o(_t,yt),o(pt,xt),o(pt,kt),o(kt,bt),xe&&xe.m(kt,null),o(a,Nt),o(a,It),o(a,jt),o(a,Ct),o(Ct,Tt),o(Tt,wt),o(wt,Ft),o(Ft,Dt),o(Tt,Lt),o(Tt,zt),o(zt,St),o(zt,qt),o(zt,Rt),o(zt,Ot),o(Tt,Pt),Ie._mount(Tt,null),o(a,Mt),o(a,Vt),Te.m(Vt,null),At=!0},p:function(a,n){if(e=n,At&&!a.params||Et===(Et=e.params.reportType.title)||f(x,Et),a.params){Xt=e.params.reportType.options;for(var s=0;s<Xt.length;s+=1){var r=A(e,Xt,s);Yt[s]?Yt[s].p(a,r):(Yt[s]=W(t,r),Yt[s].c(),Yt[s].m(b,null))}for(;s<Yt.length;s+=1)Yt[s].d(1);Yt.length=Xt.length}"о восстановлении лесов"!==e.reportType?(te?te.p(a,e):(te=B(t,e))&&te.c(),te.i(p,I)):te&&te.o(function(){te.d(1),te=null}),At&&!a.params||Gt===(Gt=e.params.organizationName.title||e.params.organizationName.value)||f(T,Gt),At&&!a.params||L===(L=e.params.organizationName.value)||(D.value=L),At&&!a.params||Kt===(Kt=e.params.inn.title||e.params.inn.value)||f(O,Kt),At&&!a.params||V===(V=e.params.inn.value)||(M.value=V);var o={};a.cols&&(o.cols=e.cols),se._set(o);var l={};a.cols&&(l.cols=e.cols),oe._set(l);var i={};a.cols&&(i.cols=e.cols),ie._set(i);var c={};a.cols&&(c.cols=e.cols),ue._set(c);var u={};a.cols&&(u.cols=e.cols),he._set(u);var d={};a.cols&&(d.cols=e.cols),ve._set(d);var h={};a.cols&&(h.cols=e.cols),fe._set(h);var m={};a.cols&&(m.cols=e.cols),_e._set(m),At&&!a.params||Ht===(Ht=e.params.reportType.title)||f(nt,Ht),At&&!a.params||Wt===(Wt=e.params.quadrantLayerId.title||e.params.quadrantLayerId.value)||f(yt,Wt),e.quadrantIds?xe?xe.p(a,e):((xe=U(t,e)).c(),xe.m(kt,null)):xe&&(xe.d(1),xe=null),At&&!a.drawstart||Bt===(Bt=e.drawstart?"Полигон рисуется":"Выделите участки полигоном")||f(Dt,Bt),At&&!a.Object&&!a.checked||Ut===(Ut=e.Object.keys(e.checked).length)||f(qt,Ut),At&&!a.layerItems||Jt===(Jt=e.layerItems.length)||f(Ot,Jt);var v={};a.layerItems&&(v.items=e.layerItems),a.hashCols&&(v.hashCols=e.hashCols),!Qt.checked&&a.checked&&(v.checked=e.checked,Qt.checked=void 0!==e.checked),Ie._set(v),Qt={},Ce===(Ce=je(e))&&Te?Te.p(a,e):(Te.d(1),(Te=Ce(t,e)).c(),Te.m(Vt,null))},i:function(t,e){At||this.m(t,e)},o:function(t){At&&(t=s(t,10),te?te.o(t):t(),se&&se._fragment.o(t),oe&&oe._fragment.o(t),ie&&ie._fragment.o(t),ue&&ue._fragment.o(t),he&&he._fragment.o(t),ve&&ve._fragment.o(t),fe&&fe._fragment.o(t),_e&&_e._fragment.o(t),Ie&&Ie._fragment.o(t),At=!1)},d:function(t){t&&i(a),c(Yt,t),v(b,"change",$t),te&&te.d(),v(D,"change",ee),v(M,"change",ae),se.destroy(),oe.destroy(),ie.destroy(),ue.destroy(),he.destroy(),ve.destroy(),fe.destroy(),_e.destroy(),v(rt,"change",ye),xe&&xe.d(),v(kt,"change",ke),v(Ft,"click",be),Ie.destroy(),Te.d()}}}function W(t,e){var a,n,s,r=e.it;return{c:function(){a=u("option"),n=d(r),a.__value=s=e.it,a.value=a.__value,a.className="svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.params&&r!==(r=e.it)&&f(n,r),t.params&&s!==(s=e.it)&&(a.__value=s),a.value=a.__value},d:function(t){t&&i(a)}}}function B(t,e){var a,n,r,c={key:"fellingForm",cols:e.cols},h=new R({root:t.root,store:t.store,data:c}),m={key:"fellingType",cols:e.cols},v=new R({root:t.root,store:t.store,data:m});return{c:function(){a=u("div"),h._fragment.c(),n=d("\r\n\t\t\t\t\t\t"),v._fragment.c()},m:function(t,e){l(t,a,e),h._mount(a,null),o(a,n),v._mount(a,null),r=!0},p:function(t,e){var a={};t.cols&&(a.cols=e.cols),h._set(a);var n={};t.cols&&(n.cols=e.cols),v._set(n)},i:function(t,e){r||this.m(t,e)},o:function(t){r&&(t=s(t,2),h&&h._fragment.o(t),v&&v._fragment.o(t),r=!1)},d:function(t){t&&i(a),h.destroy(),v.destroy()}}}function U(t,e){for(var a,n=e.quadrantIds,s=[],r=0;r<n.length;r+=1)s[r]=J(t,V(e,n,r));return{c:function(){for(var t=0;t<s.length;t+=1)s[t].c();a=h()},m:function(t,e){for(var n=0;n<s.length;n+=1)s[n].m(t,e);l(t,a,e)},p:function(e,r){if(e.quadrantIds||e.quadrantLayerId){n=r.quadrantIds;for(var o=0;o<n.length;o+=1){var l=V(r,n,o);s[o]?s[o].p(e,l):(s[o]=J(t,l),s[o].c(),s[o].m(a.parentNode,a))}for(;o<s.length;o+=1)s[o].d(1);s.length=n.length}},d:function(t){c(s,t),t&&i(a)}}}function J(t,e){var a,n,s,r,c=e.it.title;return{c:function(){a=u("option"),n=d(c),a.__value=s=e.it.id,a.value=a.__value,a.selected=r=e.quadrantLayerId===e.it.id,a.className="svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){t.quadrantIds&&c!==(c=e.it.title)&&f(n,c),t.quadrantIds&&s!==(s=e.it.id)&&(a.__value=s),a.value=a.__value,(t.quadrantLayerId||t.quadrantIds)&&r!==(r=e.quadrantLayerId===e.it.id)&&(a.selected=r)},d:function(t){t&&i(a)}}}function Q(t,e){var a,n,s;function r(e){t.sendReport()}return{c:function(){a=u("button"),n=d("Создать отчеты"),m(a,"click",r),a.className=s="gmx-sidebar-button"+(e.Object.keys(e.checked).length?"":"-disabled")+" svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n)},p:function(t,e){(t.Object||t.checked)&&s!==(s="gmx-sidebar-button"+(e.Object.keys(e.checked).length?"":"-disabled")+" svelte-gt11xl")&&(a.className=s)},d:function(t){t&&i(a),v(a,"click",r)}}}function X(t,a){var n;return{c:function(){(n=u("button")).innerHTML='<div class="lds-ellipsis svelte-gt11xl"><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div><div class="svelte-gt11xl"></div></div>',n.className="gmx-sidebar-button-disabled svelte-gt11xl"},m:function(t,e){l(t,n,e)},p:e,d:function(t){t&&i(n)}}}function Y(t){var e=this;y(this,t),this._state=a(a({Object:Object},{params:{layerID:{value:"",title:"Выбор слоя"},quadrantLayerId:{value:"",title:"Слой квартальной сети"},reportType:{value:"об использовании лесов",options:["об использовании лесов","о восстановлении лесов"],title:"Тип отчета"},organizationName:{value:"Наименование организации"},inn:{value:"1234567890",title:"ИНН"},region:{value:"Субъект",title:"Субъект Российской Федерации"},forestry:{value:"Лесничество"},sectionForestry:{value:"Участковое лесничество"},quadrant:{value:"Квартал"},stratum:{value:"Выдел"},fellingForm:{value:"",title:"Форма рубки"},fellingType:{value:"",title:"Тип рубки"},recoveryEventType:{value:"",title:"Тип мероприятия"},siteArea:{value:"Площадь"},scale:{value:"Масштаб"},site:{value:"Делянка"}},layerItems:[],format:2,limit:0,report:!1,drawstart:!1,layerID:"",quadrantLayerId:"",reportType:"",checked:{},layerIds:[],quadrantIds:[],hashCols:{},cols:[]}),t.data),this._intro=!!t.intro,this._handlers.state=[M],M.call(this,{changed:n({},this._state),current:this._state}),this._fragment=function(t,e){var a,n,s,r,c,h,g,p,_,y,x,k,b=e.layerIds&&G(t,e);function N(e){t.setNodeField(this,!0)}var I=e.layerID&&H(t,e);return{c:function(){a=u("div"),n=u("div"),s=d("Лимит отчетов: "),r=d(e.limit),c=d("\r\n\t"),h=u("div"),(g=u("span")).textContent="Выбор слоя",p=d("\r\n\t\t"),_=u("select"),y=u("option"),b&&b.c(),x=d("\r\n"),I&&I.c(),n.className="forest-plugin-header svelte-gt11xl",g.className="gmx-select-layer-container__label svelte-gt11xl",y.__value="",y.value=y.__value,y.className="svelte-gt11xl",m(_,"change",N),_.name="layerID",_.className="gmx-sidebar-select-medium svelte-gt11xl",h.className="gmx-select-layer-container svelte-gt11xl",a.className="forest-plugin-container svelte-gt11xl"},m:function(t,e){l(t,a,e),o(a,n),o(n,s),o(n,r),o(a,c),o(a,h),o(h,g),o(h,p),o(h,_),o(_,y),b&&b.m(_,null),o(a,x),I&&I.m(a,null),k=!0},p:function(e,n){k&&!e.limit||f(r,n.limit),n.layerIds?b?b.p(e,n):((b=G(t,n)).c(),b.m(_,null)):b&&(b.d(1),b=null),n.layerID?(I?I.p(e,n):(I=H(t,n))&&I.c(),I.i(a,null)):I&&I.o(function(){I.d(1),I=null})},i:function(t,e){k||this.m(t,e)},o:function(t){k&&(I?I.o(t):t(),k=!1)},d:function(t){t&&i(a),b&&b.d(),v(_,"change",N),I&&I.d()}}}(this,this._state),this.root._oncreate.push(function(){(function(){this.changedParams={};var t=this.get(),e=t.meta,a=t.gmxMap;this.getReportsCount();var n=[],s=[];a.layers.forEach(function(t){if(t.getGmxProperties){var a=t.getGmxProperties(),r=a.MetaProperties||{};if("vector"===a.type.toLowerCase()&&"polygon"===a.GeometryType.toLowerCase()&&!a.IsRasterCatalog&&!a.Quicklook){var o={id:a.name,title:a.title};e?(r.forest&&"true"===r.forest.Value&&n.push(o),r.quadrant&&"true"===r.quadrant.Value&&s.push(o)):(n.push(o),s.push(o))}}}),this.set({layerIds:n,quadrantIds:s,cols:[]})}).call(e),e.fire("update",{changed:n({},e._state),current:e._state})}),t.target&&(this._fragment.c(),this._mount(t.target,t.anchor),_(this)),this._intro=!0}return a(Y.prototype,k),a(Y.prototype,P),t.App=Y,t}({});
//# sourceMappingURL=gmxForest.js.map
